#!/bin/bash
set -e
set -o pipefail

# Fetch token published by Auth server to SSM parameter store to join the cluster
aws ssm get-parameter --with-decryption --name /teleport/{{ teleport_cluster_name }}/tokens/proxy --region {{ teleport_region }} --query Parameter.Value --output text > {{ teleport_data_dir }}token

# Fetch Auth server CA certificate to validate the identity of the auth server
aws ssm get-parameter --name /teleport/{{ teleport_cluster_name }}/ca --region={{ teleport_region }} --query=Parameter.Value --output text > {{ teleport_data_dir }}ca.cert

